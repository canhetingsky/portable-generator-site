<div
    class="not-prose my-12 max-w-2xl mx-auto rounded-2xl border border-gray-200 bg-white p-6 shadow-2xl shadow-gray-300/50">

    <div class="flex items-center mb-8">
        <div class="w-1.5 h-6 bg-blue-600 rounded-full mr-3"></div>
        <h4 class="text-xl font-bold text-gray-800 tracking-tight">
            Convert Appliance Ratings to Watts
        </h4>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">

        <div class="flex flex-col gap-2">
            <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Value</label>
            <input type="number" id="wc-value" placeholder="Enter value(e.g): 1.00" value="1.00"
                class="w-full h-12 rounded-xl border-2 border-gray-300 bg-gray-50 px-5 py-3 text-base text-gray-900 transition-all
                hover:border-gray-400 focus:border-blue-600 focus:bg-white focus:ring-4 focus:ring-blue-100 outline-none" />
        </div>

        <div class="flex flex-col gap-2">
            <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Unit</label>
            <select id="wc-unit"
                class="w-full h-12 rounded-xl border-2 border-gray-300 bg-gray-50 px-4 py-3 text-base font-medium text-gray-700 transition-all
                hover:border-gray-400 focus:border-blue-600 focus:bg-white focus:ring-4 focus:ring-blue-100 outline-none cursor-pointer">
                <option value="amps">Amps (A)</option>
                <option value="kw">Kilowatts (kW)</option>
                <option value="hp">Horsepower (HP)</option>
                <option value="kva">kVA</option>
            </select>
        </div>

        <div class="flex flex-col gap-2 min-h-[76px]">
            <div id="wc-voltage-wrap" class="hidden">
                <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1 mb-2 block">Voltage</label>
                <select id="wc-voltage"
                    class="w-full h-12 rounded-xl border-2 border-gray-300 bg-gray-50 px-4 py-3 text-base font-medium text-gray-700 transition-all
                    hover:border-gray-400 focus:border-blue-600 focus:bg-white focus:ring-4 focus:ring-blue-100 outline-none cursor-pointer">
                    <option value="120">120V</option>
                    <option value="240">240V</option>
                </select>
            </div>

            <div id="wc-factor-wrap" class="hidden">
                <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1 mb-2 block">power factor
                    (0.8-1.0)</label>
                <div class="relative">
                    <input type="number" step="0.01" min="0.8" max="1" id="wc-factor"
                        placeholder="Enter value(e.g): 0.80" value="0.90" class="peer w-full h-12 rounded-xl border-2 border-gray-300 bg-gray-50 px-5 py-3 text-base outline-none transition-all
                                invalid:border-red-500 invalid:text-red-600
                                focus:border-blue-600 focus:bg-white focus:ring-4 focus:ring-blue-100" />
                    <p class="mt-1 hidden peer-invalid:block text-[10px] text-red-500 font-medium ml-1">
                        Please enter a value between 0.8 and 1.0
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="rounded-2xl bg-blue-600 p-6 flex items-center justify-between shadow-lg shadow-blue-200">
        <span class="text-sm font-bold text-blue-100 uppercase tracking-widest">Convert Power</span>
        <div class="flex items-baseline gap-2">
            <span id="wc-result" class="text-4xl font-black text-white">—</span>
            <span class="text-sm font-bold text-blue-200 uppercase">Watts</span>
        </div>
    </div>

    <div id="note-wrap" class="hidden mt-6 flex items-start gap-3 px-1">
        <svg class="w-5 h-5 text-gray-400 shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                clip-rule="evenodd"></path>
        </svg>
        <p class="text-xs text-gray-500 leading-relaxed italic">
            Note: HP-to-watts conversion is approximate. Motor efficiency and actual load vary.
        </p>
    </div>
</div>

<script>
    (function () {
        const valueEl = document.getElementById('wc-value');
        const unitEl = document.getElementById('wc-unit');
        const voltageWrap = document.getElementById('wc-voltage-wrap');
        const voltageEl = document.getElementById('wc-voltage');
        const factorWrap = document.getElementById('wc-factor-wrap');
        const factorEl = document.getElementById('wc-factor');
        const resultEl = document.getElementById('wc-result');
        const noteE1 = document.getElementById('note-wrap');

        function calculateWatts() {
            const value = parseFloat(valueEl.value);
            if (isNaN(value)) {
                resultEl.textContent = '—';
                return;
            }

            let watts = 0;
            switch (unitEl.value) {
                case 'amps':
                    watts = value * parseFloat(voltageEl.value || 120);
                    break;
                case 'kw':
                    watts = value * 1000;
                    break;
                case 'hp':
                    watts = value * 746;
                    break;
                case 'kva':
                    // 获取 PF 并在 0.8-1.0 之间约束
                    let pf = parseFloat(factorEl.value);
                    if (isNaN(pf) || pf < 0.8 || pf > 1.0) {
                        resultEl.textContent = '—';
                        return;
                    }
                    watts = value * 1000 * pf;
                    break;
            }
            if (unitEl.value == 'hp') {
                noteE1.classList.toggle('hidden', false);;
            }
            else {
                noteE1.classList.toggle('hidden', true);;
            }
            resultEl.textContent = Math.round(watts).toLocaleString();
        }

        function updateVisibility() {
            const unit = unitEl.value;
            // 完全使用 hidden 类切换，不留任何外边距
            voltageWrap.classList.toggle('hidden', unit !== 'amps');
            factorWrap.classList.toggle('hidden', unit !== 'kva');
        }

        unitEl.addEventListener('change', () => {
            updateVisibility();
            calculateWatts();
        });

        [valueEl, voltageEl, factorEl].forEach(el => {
            if (!el) return;

            // 1. 您的原始逻辑：实时输入时计算结果
            el.addEventListener('input', calculateWatts);

            // 2. 新增逻辑：针对 Power Factor 失去焦点时自动纠错
            if (el.id === 'wc-factor') {
                el.addEventListener('blur', function () {
                    let val = parseFloat(this.value);
                    if (isNaN(val)) return;

                    if (val < 0.8) {
                        this.value = "0.8"; // 自动修正为最小值
                    } else if (val > 1.0) {
                        this.value = "1.0"; // 自动修正为最大值
                    }
                    calculateWatts(); // 修正后重新触发一次计算
                });
            }
        });

        updateVisibility();
        calculateWatts();
    })();
</script>